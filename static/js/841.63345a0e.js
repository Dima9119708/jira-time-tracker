"use strict";(self.webpackChunkjira_time_tracker=self.webpackChunkjira_time_tracker||[]).push([[841],{5841:(e,s,a)=>{a.d(s,{FiltersPage:()=>F,loaderFilters:()=>_});var t=a(4064),i=a(1083);const r=e=>(0,t.t)({queryKey:["tasks"],queryFn:async s=>(await i.b.get("/tasks",{params:{jql:e,startAt:5*s.pageParam,maxResults:5},signal:s.signal})).data,getNextPageParam:(e,s,a,t)=>e.issues.length>0?a+1:null,initialPageParam:0});var n=a(9908),d=a(235),l=a(2708),o=a(2792),c=a(7294),u=a(2321),m=a(5893);const h=()=>{const{ref:e,inView:s}=(0,l.YD)(),{isFetching:a,isFetchingNextPage:t,hasNextPage:i,fetchNextPage:d}=(0,n.N)(r(""));return(0,c.useEffect)((()=>{s&&!a&&d()}),[s,a]),(0,m.jsxs)(o.z,{variant:"light",color:"blue",onClick:()=>d(),fullWidth:!0,children:[t?"Loading more...":i?"Load More":"Nothing more to load",(0,m.jsx)("span",{ref:e,className:(0,u.cn)("invisible",{hidden:t})})]})},g=(0,c.memo)(h);var x=a(9855),p=a(5453),y=a(9448),j=a(7311),f=a(202);const k=e=>{const s=Math.floor(e/60),a=Math.floor(s/60);return"".concat(String(a).padStart(2,"0"),":").concat(String(s%60).padStart(2,"0"))};var b=a(6205),v=a(830),w=a(9341),P=a(8551);const N=e=>{const{id:s,onChange:a,children:t,position:r="bottom-start",disabled:n}=e,[d,l]=(0,c.useState)(!1),{data:o,isLoading:u}=(0,P.a)({queryKey:["statuses task",s],queryFn:()=>i.b.get("/statuses-task",{params:{id:s}}),select:e=>e.data,enabled:d});return(0,m.jsxs)(v.v,{shadow:"md",onChange:n?void 0:l,position:r,disabled:n,children:[(0,m.jsx)(v.v.Target,{children:t}),(0,m.jsxs)(v.v.Dropdown,{children:[u&&Array.from({length:5},((e,s)=>(0,m.jsx)(v.v.Item,{children:(0,m.jsx)(w.O,{w:100,h:20,bg:"cyan.6"})},s))),!u&&(null==o?void 0:o.transitions.map((e=>(0,m.jsx)(v.v.Item,{onClick:()=>a(e),value:e.name,children:e.name},e.id))))]})]})};var C=a(3513);const q=e=>{const{id:s,queryKey:a,children:t,position:r,disabled:n,idxPage:d,idxIssue:l,onChange:o}=e,c=(0,f.NL)(),{mutate:u}=(0,b.D)({mutationFn:e=>i.b.post("/change-status-task",{taskId:s,transitionId:e.id}),onMutate:async e=>{await c.cancelQueries({queryKey:[a]});const s=c.getQueryData([a]);return c.setQueryData([a],(s=>(0,C.Uy)(s,(s=>{s.pages[d].issues[l].fields.status=e.to})))),"function"==typeof o&&o(),{oldState:s}},onError:(e,s,t)=>{c.setQueryData([a],t.oldState)}});return(0,m.jsx)(N,{id:s,position:r,disabled:n,onChange:e=>u(e),children:t})},I=e=>{const{fields:s,id:a,setSearchParams:t,idxPage:i,idxIssue:r}=e,n=(0,f.NL)(),l=()=>{t((e=>{let s=a;for(const a of e.values())a&&(s+=",".concat(a));return{keysTaskTracking:s}})),n.setQueryData(["tasks"],(e=>(0,C.Uy)(e,(e=>{e.pages[i].issues.splice(r,1)}))))};return(0,m.jsxs)(x.Z,{shadow:"sm",radius:"md",mb:"sm",withBorder:!0,children:[(0,m.jsxs)(p.Z,{mb:10,justify:"space-between",children:[(0,m.jsx)(d.D,{order:5,children:s.summary}),(0,m.jsxs)(y.C,{color:"blue",className:"flex-row",children:[(0,m.jsx)("span",{className:"mr-[0.5rem]",children:k(s.timespent)}),(0,m.jsx)("span",{className:"mr-[0.5rem]",children:"/"}),(0,m.jsx)("span",{children:k(s.timeoriginalestimate)})]})]}),(0,m.jsxs)(p.Z,{justify:"space-between",children:[(0,m.jsx)(q,{id:a,idxPage:i,idxIssue:r,queryKey:"tasks",children:(0,m.jsx)(o.z,{variant:"outline",size:"xs",children:s.status.name})}),(0,m.jsx)(q,{id:a,idxPage:i,idxIssue:r,queryKey:"tasks",position:"left",onChange:()=>l(),disabled:"indeterminate"===s.status.statusCategory.key,children:(0,m.jsx)(j.Z,{className:"cursor-pointer [&_path]:fill-[var(--mantine-color-violet-5)]",..."indeterminate"===s.status.statusCategory.key&&{onClick:l}})})]})]},a)},D=(0,c.memo)(I);var S=a(9655);const F=()=>{const[,e]=(0,S.lr)(),{data:s}=(0,n.N)(r(""));return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d.D,{mb:10,order:2,children:"Tasks"}),null==s?void 0:s.pages.map(((s,a)=>s.issues.map(((s,t)=>(0,m.jsx)(D,{idxPage:a,idxIssue:t,fields:s.fields,id:s.id,setSearchParams:e},s.id))))),(0,m.jsx)(g,{})]})},_=e=>async()=>{try{const s=await i.b.get("/filters");let a="";if(s.data.values.length>0){a=(await i.b.get("/filter-details",{params:{id:s.data.values[0].id}})).data.jql}else{a=(await i.b.post("/filter-details",{name:"TimeTracking___",description:"",jql:""})).data.jql}e.prefetchInfiniteQuery(r(a))}catch(e){}return!0}}}]);