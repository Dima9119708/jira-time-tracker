"use strict";(self.webpackChunkjira_time_tracker=self.webpackChunkjira_time_tracker||[]).push([[800],{3800:(s,e,t)=>{t.d(e,{TasksPage:()=>U,loaderTasks:()=>d});var a=t(3191),r=t(1083);const n=(s,e)=>(0,a.C)({queryKey:["tasks"],queryFn:t=>{let{signal:a}=t;return r.b.get("/tasks",{params:{id:s,keys:e},signal:a}).then((s=>s.data))},gcTime:0}),i=(s,e)=>(0,a.C)({queryKey:["tracking tasks"],queryFn:t=>{let{signal:a}=t;return e.length?r.b.get("/tracking-tasks",{params:{id:s,keys:e},signal:a}).then((s=>s.data)):null},gcTime:0}),d=s=>e=>{let{params:t,request:a}=e;const r=new URL(a.url).searchParams.get("keysTaskTracking");return t.boardId&&s.prefetchQuery(n(t.boardId,r)),r&&s.prefetchQuery(i(t.boardId,r)),!0};var l=t(235),c=t(2982),o=t(4435),u=t(9250),m=t(9655),h=t(9855),k=t(5453),y=t(9448),g=t(2792),j=t(7294),x=t(7311),p=t(202);const f=s=>{const e=Math.floor(s/60),t=Math.floor(e/60);return"".concat(String(t).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))};var b=t(6205),v=t(830),w=t(9341),T=t(5893);const C=s=>{const{id:e,onChange:t,children:a,position:n="bottom-start",disabled:i}=s,[d,l]=(0,j.useState)(!1),{data:c,isLoading:u}=(0,o.a)({queryKey:["statuses task",e],queryFn:()=>r.b.get("/statuses-task",{params:{id:e}}),select:s=>s.data,enabled:d});return(0,T.jsxs)(v.v,{shadow:"md",onChange:i?void 0:l,position:n,disabled:i,children:[(0,T.jsx)(v.v.Target,{children:a}),(0,T.jsxs)(v.v.Dropdown,{children:[u&&Array.from({length:5},((s,e)=>(0,T.jsx)(v.v.Item,{children:(0,T.jsx)(w.O,{w:100,h:20,bg:"cyan.6"})},e))),!u&&(null==c?void 0:c.transitions.map((s=>(0,T.jsx)(v.v.Item,{onClick:()=>t(s),value:s.name,children:s.name},s.id))))]})]})};var I=t(3513);const D=s=>{const{id:e,queryKey:t,children:a,position:n,disabled:i,onChange:d}=s,l=(0,p.NL)(),{mutate:c}=(0,b.D)({mutationFn:s=>r.b.post("/change-status-task",{taskId:e,transitionId:s.id}),onMutate:async s=>{await l.cancelQueries({queryKey:[t]});const a=l.getQueryData([t]);return l.setQueryData([t],(t=>{const a=(0,I.Uy)(t.issues,(t=>{const a=t.findIndex((s=>s.id===e));t[a].fields.status=s.to}));return{...t,issues:a}})),"function"==typeof d&&d(),{oldState:a}},onError:(s,e,a)=>{l.setQueryData([t],a.oldState)}});return(0,T.jsx)(C,{id:e,position:n,disabled:i,onChange:s=>c(s),children:a})},N=s=>{const{fields:e,id:t,setSearchParams:a}=s,r=(0,p.NL)(),n=()=>{a((s=>{let e=t;for(const t of s.values())t&&(e+=",".concat(t));return{keysTaskTracking:e}}));const s=r.getQueryData(["tasks"]).issues.find((s=>s.id===t));r.setQueryData(["tracking tasks"],(e=>({...e,issues:[s,...e?e.issues:[]]}))),r.setQueryData(["tasks"],(e=>({...e,issues:(e?e.issues:[]).filter((e=>e.id!==s.id))})))};return(0,T.jsxs)(h.Z,{shadow:"sm",radius:"md",mb:"sm",withBorder:!0,children:[(0,T.jsxs)(k.Z,{mb:10,justify:"space-between",children:[(0,T.jsx)(l.D,{order:5,children:e.summary}),(0,T.jsxs)(y.C,{color:"blue",className:"flex-row",children:[(0,T.jsx)("span",{className:"mr-[0.5rem]",children:f(e.timespent)}),(0,T.jsx)("span",{className:"mr-[0.5rem]",children:"/"}),(0,T.jsx)("span",{children:f(e.timeoriginalestimate)})]})]}),(0,T.jsxs)(k.Z,{justify:"space-between",children:[(0,T.jsx)(D,{id:t,queryKey:"tasks",children:(0,T.jsx)(g.z,{variant:"outline",size:"xs",children:e.status.name})}),(0,T.jsx)(D,{id:t,queryKey:"tasks",position:"left",onChange:()=>n(),disabled:"indeterminate"===e.status.statusCategory.key,children:(0,T.jsx)(x.Z,{className:"cursor-pointer [&_path]:fill-[var(--mantine-color-violet-5)]",..."indeterminate"===e.status.statusCategory.key&&{onClick:n}})})]})]},t)},q=(0,j.memo)(N),S=()=>{const s=(0,u.UO)(),[e,t]=(0,m.lr)(),{data:a}=(0,o.a)(n(s.boardId,e.get("keysTaskTracking")));return null==a?void 0:a.issues.map((s=>{let{fields:e,id:a}=s;return(0,T.jsx)(q,{id:a,fields:e,setSearchParams:t},a)}))};var Q=t(6209),Z=t(6485),K=t(2276),P=t(7484),_=t.n(P);const z=()=>{const[s,e]=(0,j.useState)(_()().startOf("day")),t=s.format("HH:mm:ss");return(0,j.useEffect)((()=>{let s;return s=setInterval((()=>{e((s=>s.add(1,"second")))}),1e3),()=>clearInterval(s)}),[]),(0,T.jsx)(y.C,{mb:10,size:"xl",radius:"sm",variant:"filled",children:t})},F=s=>{const{fields:e,id:t,setSearchParams:a}=s,r=(0,p.NL)();return(0,T.jsxs)(h.Z,{shadow:"sm",radius:"md",bg:"teal.0",mb:"sm",withBorder:!0,children:[(0,T.jsx)(z,{}),(0,T.jsxs)(k.Z,{mb:10,justify:"space-between",children:["indeterminate"!==e.status.statusCategory.key&&(0,T.jsx)(Q.b,{className:"w-[100%]",variant:"light",color:"red",title:"Warning!",icon:(0,T.jsx)(Z.Z,{}),children:'This task is not in the "In progress" status please change its status. However, time continues to be logged for it.'}),(0,T.jsx)(l.D,{order:5,children:e.summary}),(0,T.jsxs)(y.C,{color:"blue",className:"flex-row",children:[(0,T.jsx)("span",{className:"mr-[0.5rem]",children:f(e.timespent)}),(0,T.jsx)("span",{className:"mr-[0.5rem]",children:"/"}),(0,T.jsx)("span",{children:f(e.timeoriginalestimate)})]})]}),(0,T.jsxs)(k.Z,{justify:"space-between",children:[(0,T.jsx)(D,{id:t,queryKey:"tracking tasks",children:(0,T.jsx)(g.z,{variant:"outline",size:"xs",children:e.status.name})}),(0,T.jsx)(K.Z,{onClick:()=>{a((e=>{const a=e.get("keysTaskTracking").split(",").map((s=>parseInt(s,10))),n=a.indexOf(Number(t));-1!==n&&a.splice(n,1);const i=a.join(",");return r.setQueryData(["tracking tasks"],(s=>({...s,issues:s.issues.filter((s=>s.id!==t))}))),r.setQueryData(["tasks"],(e=>({...e,issues:[s,...e.issues]}))),{keysTaskTracking:i}}))},className:"cursor-pointer [&_path]:fill-[var(--mantine-color-violet-5)]"})]})]},t)},L=(0,j.memo)(F),O=()=>{const s=(0,u.UO)(),[e,t]=(0,m.lr)(),{data:a}=(0,o.a)(i(s.boardId,e.get("keysTaskTracking")));return null==a?void 0:a.issues.map((s=>{let{fields:e,id:a}=s;return(0,T.jsx)(L,{id:a,fields:e,setSearchParams:t},a)}))},U=()=>((0,c.h)({items:[{link:"/projects",title:"Projects"}]}),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.D,{mb:10,order:2,children:"Tasks"}),(0,T.jsx)(O,{}),(0,T.jsx)(S,{})]}))}}]);