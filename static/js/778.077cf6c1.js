"use strict";(self.webpackChunkjira_time_tracker=self.webpackChunkjira_time_tracker||[]).push([[778],{14778:(e,t,r)=>{r.r(t),r.d(t,{default:()=>oe});var s=r(94203),n=r(29731),i=r(73750),o=r(27779),a=r(40313),d=r(60659),l=r(64561),c=r(65251),u=r(97665),m=r(99253),p=r(53857),h=r(15490),x=r(52340),g=r(88764),j=r(96540),S=r(74353),C=r.n(S),A=r(96871),b=r(74848);const k={head:(0,p.S7)({display:"grid",gridTemplateColumns:"subgrid",gridColumn:"1 / -1",gridRow:"1 / 1",color:"color.text.subtle",fontWeight:"font.weight.bold",alignItems:"center",borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"color.border.muted"}),body:(0,p.S7)({display:"grid",gridTemplateColumns:"subgrid",gap:"space.150",gridColumn:"1 / -1",position:"relative"}),row:(0,p.S7)({position:"relative",display:"grid",gridTemplateColumns:"subgrid",gridColumn:"1 / -1",alignItems:"center",color:"color.text",borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"color.border.bold"}),cell:(0,p.S7)({wordBreak:"break-word"}),rowDetail:(0,p.S7)({display:"grid",gridTemplateColumns:"subgrid",gridColumn:"1 / -1",paddingTop:"space.150",paddingBottom:"space.150"})},y=e=>{let{children:t}=e;return(0,b.jsx)(h.A,{xcss:k.head,children:t})},f=e=>{let{children:t}=e;return(0,b.jsx)(h.A,{xcss:k.body,children:t})},v=e=>{let{children:t}=e;return(0,b.jsx)(h.A,{xcss:k.row,children:t})},w=e=>{let{children:t,styles:r}=e;return(0,b.jsx)(h.A,{xcss:r,children:t})},I=e=>{let{children:t}=e;return(0,b.jsx)(h.A,{xcss:k.rowDetail,children:t})},D=e=>{const{children:t,gridTemplateColumns:r,minWidth:s="600px"}=e;return(0,b.jsx)(h.A,{xcss:(0,p.S7)({display:"grid",gridTemplateRows:"auto 1fr",gap:"space.100",minWidth:s,gridTemplateColumns:r}),children:t})};var T=r(4513),B=r(44531),R=r(8290),W=r(35806),P=r(12596),U=r(24681),E=r(17673),F=r(96077),L=r(67459),N=r(3973),O=r(72787),z=r(97066),G=r(62494),K=r(15208),M=r(43164),q=r(53110),H=r(49785),J=r(23048),_=r(57464);const Q={startDate:"",issueId:"",timeSpent:"",description:""},V={editCell:(0,p.S7)({"&:hover":{outlineWidth:"1px",outlineStyle:"solid",outlineColor:"var(--ds-blanket, #091E427D)"}})},X=(0,j.memo)((e=>{const{date:t,worklogRefetch:r}=e,[s,n]=(0,j.useState)(!1),{worklogPOST:i}=(0,z.r)({enabledGetIssueWorklogs:!1,enabledGetWorklogs:!1,post:{onSuccess:()=>{r()},onError:()=>{r()}}}),{control:o,handleSubmit:a}=(0,H.mN)({values:{...Q,startDate:t}}),l=e=>{i.mutate(e),n(!1)};return(0,b.jsx)(B.z,{isOpen:s,onClose:()=>n((e=>!e)),content:()=>s&&(0,b.jsxs)(h.A,{xcss:(0,p.S7)({padding:"space.150",backgroundColor:"color.background.neutral",minWidth:"300px",maxWidth:"400px"}),children:[(0,b.jsx)(H.xI,{control:o,rules:{required:"Required"},name:"issueId",render:e=>{let{field:t,fieldState:r}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.d,{issueId:t.value,onChange:e=>t.onChange(e.id)}),!!r.error?.message&&(0,b.jsx)(J.Kw,{children:r.error?.message})]})}}),(0,b.jsx)(h.A,{xcss:(0,p.S7)({marginTop:"space.100",marginBottom:"space.100"})}),(0,b.jsx)(H.xI,{control:o,name:"startDate",render:e=>{let{field:t,fieldState:r}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_.JU,{htmlFor:"startDate",children:"Date"}),(0,b.jsx)(m.A,{value:t.value,label:"startDate",placeholder:W.D,dateFormat:W.D,onChange:t.onChange}),!!r.error?.message&&(0,b.jsx)(J.Kw,{children:r.error?.message})]})}}),(0,b.jsx)(h.A,{xcss:(0,p.S7)({marginTop:"space.100",marginBottom:"space.100"})}),(0,b.jsx)(H.xI,{name:"timeSpent",control:o,rules:{required:"Required"},render:e=>{let{field:t,fieldState:r}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_.JU,{htmlFor:"timeSpent",children:"Time spent"}),(0,b.jsx)(E.A,{value:t.value,id:"timeSpent",onChange:t.onChange,onBlur:t.onBlur,placeholder:"Use the format 2w 3d 4h 5m"}),!!r.error?.message&&(0,b.jsx)(J.Kw,{children:r.error?.message})]})}}),(0,b.jsx)(h.A,{xcss:(0,p.S7)({paddingBottom:"space.100"}),children:(0,b.jsx)(H.xI,{name:"description",control:o,render:e=>{let{field:t}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_.JU,{htmlFor:"description",children:"Description"}),(0,b.jsx)(T.A,{resize:"vertical",value:t.value,id:"Description",onChange:t.onChange,onBlur:t.onBlur,placeholder:"Description",onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0})]})}})}),(0,b.jsxs)(x.A,{justifyContent:"end",columnGap:"space.100",children:[(0,b.jsx)(d.A,{appearance:"default",onClick:()=>n((e=>!e)),children:"Cancel"}),(0,b.jsx)(d.A,{isLoading:i.isPending,onClick:a(l),appearance:"primary",children:"Save"})]})]}),shouldRenderToParent:!0,trigger:e=>(0,b.jsx)(d.A,{...e,onClick:()=>n((e=>!e)),appearance:"discovery",children:"Log time"})})})),Y=(0,j.memo)((e=>{let{description:t,onChange:r}=e;const[s,n]=(0,j.useState)(!1);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.A,{xcss:(0,p.S7)({gridColumn:"1 / 2",color:"color.text.subtle",fontWeight:"font.weight.bold"}),children:"Description"}),(0,b.jsx)(B.z,{isOpen:s,onClose:()=>n((e=>!e)),placement:"bottom-start",content:()=>(0,b.jsx)(h.A,{xcss:(0,p.S7)({padding:"space.150",minHeight:"250px",minWidth:"250px",backgroundColor:"color.background.neutral"}),children:(0,b.jsx)(T.A,{style:{minHeight:"inherit",minWidth:"inherit"},resize:"auto",defaultValue:t,onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0,onBlur:e=>{t!==e.target.value&&r(e.target.value)}})}),shouldRenderToParent:!0,trigger:e=>(0,b.jsx)(h.A,{xcss:(0,p.S7)({wordBreak:"break-all",gridColumn:"2 / -1"}),children:(0,b.jsx)(h.A,{as:"span",xcss:V.editCell,...e,onClick:()=>n((e=>!e)),children:t})})})]})})),Z=(0,j.memo)((e=>{let{onDelete:t}=e;return(0,b.jsx)(N.w,{title:"Are you sure you want to delete this worklog?",onYes:t})})),$=(0,j.memo)((e=>{let{timeSpentSeconds:t,timeSpent:r,onChange:s}=e;const[n,i]=(0,j.useState)(!1);return(0,b.jsx)(B.z,{isOpen:n,onClose:()=>i((e=>!e)),placement:"bottom-start",content:()=>(0,b.jsxs)(h.A,{xcss:(0,p.S7)({padding:"space.150",minWidth:"30px",minHeight:"30px",backgroundColor:"color.background.neutral"}),children:[(0,b.jsx)(G.V,{}),(0,b.jsx)(E.A,{isCompact:!0,defaultValue:r,onBlur:e=>{r!==e.target.value&&s(e.target.value)}})]}),shouldRenderToParent:!0,trigger:e=>(0,b.jsx)(h.A,{...e,onClick:()=>i((e=>!e)),children:(0,b.jsx)(h.A,{as:"span",xcss:V.editCell,children:(0,U.M)(t,!0)})})})})),ee=(0,j.memo)((e=>{let{issueId:t,issueSummary:r,issueIcon:s,issueKey:n,onChange:i}=e;const[o,a]=(0,j.useState)(!1);return(0,b.jsx)(B.z,{isOpen:o,onClose:()=>a((e=>!e)),placement:"bottom-start",content:()=>(0,b.jsx)(h.A,{xcss:(0,p.S7)({padding:"space.150",minWidth:"300px",maxWidth:"400px",backgroundColor:"color.background.neutral"}),children:(0,b.jsx)(K.d,{placement:"top-start",issueId:t,onChange:async e=>{a((e=>!e)),i(e.id)}})}),shouldRenderToParent:!0,trigger:e=>(0,b.jsx)(h.A,{...e,onClick:()=>a((e=>!e)),children:(0,b.jsxs)(x.A,{columnGap:"space.050",wrap:"wrap",xcss:V.editCell,children:[(0,b.jsx)(R.A,{src:s}),(0,b.jsx)(g.A,{children:n}),(0,b.jsx)(g.A,{children:r})]})})})})),te=(0,j.memo)((e=>{let{authorAvatarUrl:t,authorDisplayName:r}=e;return(0,b.jsxs)(x.A,{columnGap:"space.050",alignItems:"center",children:[(0,b.jsx)(R.A,{height:"20px",width:"20px",src:t}),(0,b.jsx)(g.A,{children:r})]})})),re=(0,j.memo)((e=>{let{date:t,onChange:r}=e;const[s,n]=(0,j.useState)(!1);return(0,b.jsx)(B.z,{isOpen:s,onClose:()=>n((e=>!e)),placement:"bottom-start",content:()=>(0,b.jsx)(h.A,{xcss:(0,p.S7)({padding:"space.150",width:"250px",backgroundColor:"color.background.neutral"}),children:(0,b.jsx)(m.A,{value:t,dateFormat:W.D,onChange:e=>{r(e),n((e=>!e))}})}),shouldRenderToParent:!0,trigger:e=>(0,b.jsx)(h.A,{...e,onClick:()=>n((e=>!e)),children:(0,b.jsxs)(h.A,{as:"span",xcss:V.editCell,children:[" ",t]})})})})),se=(0,j.memo)((e=>{const{id:t,issueId:r,issueKey:s,issueSummary:n,issueIcon:i,timeSpent:o,authorAvatarUrl:a,authorDisplayName:d,description:l,date:c,timeSpentSeconds:u,worklogsQueryRefetch:m}=e,p=(0,M.E)(),h=(0,j.useRef)({id:t,issueId:r,issueKey:s,issueSummary:n,issueIcon:i,timeSpent:o,authorAvatarUrl:a,authorDisplayName:d,description:l,date:c,timeSpentSeconds:u}),{worklogPUT:x,worklogDELETE:g,worklogPOST:S}=(0,z.r)({enabledGetIssueWorklogs:!1,enabledGetWorklogs:!1,put:{onSuccess:()=>{m()},onError:()=>{m()}},post:{onSuccess:()=>{m()},onError:()=>{m()}},delete:{onSuccess:e=>{!1!==e.customFields?.isRefetchWorklogsAfterDelete&&m()},onError:()=>{m()}}});(0,j.useEffect)((()=>{h.current=Object.assign(h.current,{id:t,issueId:r,issueKey:s,issueSummary:n,issueIcon:i,timeSpent:o,authorAvatarUrl:a,authorDisplayName:d,description:l,date:c,timeSpentSeconds:u})}),[e]);const C=(0,j.useCallback)((e=>{x.mutate({issueId:h.current.issueId,id:h.current.id,startDate:e,timeSpent:h.current.timeSpent,description:h.current.description})}),[]),A=(0,j.useCallback)((async e=>{try{await g.mutateAsync({issueId:h.current.issueId,id:h.current.id,customFields:{isRefetchWorklogsAfterDelete:!1}}),await S.mutateAsync({issueId:e,startDate:h.current.date,timeSpent:h.current.timeSpent,description:h.current.description})}catch(e){e instanceof q.pe&&p.error({title:JSON.stringify(e.response?.data||"")})}}),[]),k=(0,j.useCallback)((e=>{x.mutate({issueId:h.current.issueId,id:h.current.id,startDate:h.current.date,timeSpent:h.current.timeSpent,description:e})}),[]),y=(0,j.useCallback)((e=>{x.mutate({issueId:h.current.issueId,id:h.current.id,startDate:h.current.date,timeSpent:e,description:h.current.description})}),[]),f=(0,j.useCallback)((()=>{g.mutate({issueId:h.current.issueId,id:h.current.id})}),[]);return(0,b.jsxs)(v,{children:[(x.isPending||g.isPending||S.isPending)&&(0,b.jsx)("div",{style:{position:"absolute",inset:0,backgroundColor:"var(--ds-background-neutral, #091E420F)",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsx)(L.A,{})}),(0,b.jsx)(w,{children:(0,b.jsx)(re,{date:c,onChange:C})}),(0,b.jsx)(w,{children:(0,b.jsx)(te,{authorAvatarUrl:a,authorDisplayName:d})}),(0,b.jsx)(w,{children:(0,b.jsx)(ee,{issueId:r,issueKey:s,issueSummary:n,issueIcon:i,onChange:A})}),(0,b.jsx)(w,{children:(0,b.jsx)($,{timeSpent:o,timeSpentSeconds:u,onChange:y})}),(0,b.jsx)(w,{children:(0,b.jsx)(Z,{onDelete:f})}),(0,b.jsx)(I,{children:(0,b.jsx)(Y,{description:l,onChange:k})})]})})),ne=(0,j.memo)((e=>{let{projectName:t,totalLogged:r,children:s,projectAvatarURL:n}=e;return(0,b.jsxs)(h.A,{xcss:(0,p.S7)({marginBottom:"space.300",overflowX:"auto"}),children:[(0,b.jsx)(h.A,{xcss:(0,p.S7)({marginBottom:"space.200",backgroundColor:"color.background.neutral",padding:"space.100",borderRadius:"border.radius.200"}),children:(0,b.jsxs)(x.A,{alignItems:"center",columnGap:"space.100",children:[(0,b.jsx)(R.A,{src:n,height:"24px",width:"24px"}),(0,b.jsxs)(P.A,{as:"h2",size:"small",children:[" ","Project: ",t]})]})}),(0,b.jsxs)(D,{gridTemplateColumns:"auto auto auto auto 0.2fr",minWidth:"500px",children:[(0,b.jsxs)(y,{children:[(0,b.jsx)(w,{children:"Date"}),(0,b.jsx)(w,{children:"User"}),(0,b.jsx)(w,{children:"Issue"}),(0,b.jsxs)(w,{children:["Logged"," ",(0,b.jsx)("div",{children:(0,b.jsxs)(g.A,{color:"color.text",children:["(",(0,U.M)(r,!0),")"]})})]}),(0,b.jsx)(w,{})]}),(0,b.jsx)(f,{children:s})]})]},t)})),ie=(0,j.memo)((e=>{let{date:t,setDate:r}=e;const s=(0,j.useMemo)((()=>[t]),[t]);return(0,b.jsx)(h.A,{xcss:(0,p.S7)({marginBottom:"space.250"}),children:(0,b.jsx)(h.A,{xcss:(0,p.S7)({display:"flex",justifyContent:"center",borderRadius:"border.radius.200",width:"100%"}),children:(0,b.jsx)(O.A,{selected:s,previouslySelected:s,onSelect:e=>{r(e?e.iso:t)}})})})})),oe=()=>{const{setFalse:e}=(0,A.HN)(),[t,r]=(0,j.useState)(!1),m=(0,u.jE)(),[g,S]=(0,j.useState)((()=>C()().format(W.D))),{worklogs:k,wasMutationSuccessfulAndCacheCleared:y}=(0,z.r)({mutationGcTime:1/0,from:C()(g).startOf("day"),to:C()(g).endOf("day")}),f=(0,j.useMemo)((()=>{if(k.data){const e=k.data.reduce(((e,t)=>{let[,r]=t;const s=r.reduce(((e,t)=>e+t.timeSpentSeconds),0);return e+s}),0);return(0,U.M)(e,!0)}return""}),[k.data]),v=(0,j.useCallback)((async()=>{y()&&(r(!0),await m.invalidateQueries(),r(t)),e("timesheet")}),[]);return(0,b.jsxs)(s.A,{width:"x-large",onClose:v,children:[(0,b.jsxs)(n.A,{children:[(0,b.jsx)(i.A,{children:(0,b.jsxs)(x.A,{columnGap:"space.100",alignItems:"center",children:["Timesheet",(0,b.jsx)(X,{date:g,worklogRefetch:k.refetch})]})}),(0,b.jsx)(l.A,{isLoading:t,appearance:"subtle",icon:c.A,label:"Close Modal",onClick:v})]}),(0,b.jsxs)(o.A,{children:[(0,b.jsx)(ie,{date:g,setDate:S}),!k.isLoading&&0===k?.data?.length&&(0,b.jsx)(F.A,{header:"Nothing logged for the selected date",description:"Currently, there’s no logged time for this date. Entries will appear here once they’re added."}),k.isFetching&&!k?.data&&(0,b.jsx)(F.A,{header:"",description:(0,b.jsx)(L.A,{})}),!k.isLoading&&k?.data&&k?.data?.length>0&&(0,b.jsx)(h.A,{xcss:(0,p.S7)({textAlign:"center",marginBottom:"space.200",backgroundColor:"color.background.neutral",padding:"space.100",borderRadius:"border.radius.200"}),children:(0,b.jsxs)(P.A,{as:"h2",size:"small",children:["Total time: ",f]})}),k?.data?.map((e=>{let[t,r]=e;const s=r[0].project.avatarUrl,n=r.reduce(((e,t)=>e+t.timeSpentSeconds),0);return(0,b.jsx)(ne,{projectName:t,totalLogged:n,projectAvatarURL:s,children:r.map((e=>(0,b.jsx)(se,{issueId:e.issue.id,date:e.date,id:e.id,timeSpent:e.timeSpent,description:e.description,issueSummary:e.issue.summary,issueIcon:e.issue.icon,issueKey:e.issue.key,authorDisplayName:e.author.displayName,timeSpentSeconds:e.timeSpentSeconds,authorAvatarUrl:e.author.avatarUrls["16x16"],worklogsQueryRefetch:k.refetch},e.id)))},t)}))]}),(0,b.jsx)(a.A,{children:(0,b.jsx)(d.A,{isLoading:t,appearance:"default",onClick:v,children:"Cancel"})})]})}}}]);