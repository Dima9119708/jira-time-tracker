"use strict";(self.webpackChunkjira_time_tracker=self.webpackChunkjira_time_tracker||[]).push([[609],{20924:(e,r,a)=>{a.d(r,{A:()=>v});var o=a(58168),n=a(80045),i=a(96540),t=a(17437),c=a(47917),d=a(31931),s=a(1513),l=["ariaLabel","isDisabled","isRequired","isInvalid","isChecked","label","name","onChange","value","testId","analyticsContext"],u=d.A,p=(0,t.AH)({padding:"var(--ds-space-025, 2px)".concat(" ","var(--ds-space-050, 4px)")}),g=(0,t.AH)({display:"flex",boxSizing:"border-box",position:"relative",alignItems:"flex-start",color:"var(--ds-text, ".concat(s.ug,")"),font:'var(--ds-font-body, normal 400 14px/20px ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Ubuntu, system-ui, "Helvetica Neue", sans-serif)',"&[data-disabled]":{color:"var(--ds-text-disabled, ".concat(s.nb,")"),cursor:"not-allowed"}}),h=(0,t.AH)({display:"flex",width:"24px",height:"24px",margin:"var(--ds-space-0, 0px)",position:"relative",alignItems:"center",justifyContent:"center",flexShrink:0,backgroundColor:"var(--radio-background-color)",border:"var(--ds-border-width, 1px)".concat(" solid var(--radio-border-color)"),borderRadius:"var(--ds-border-radius-circle, 50%)",MozAppearance:"none",outline:"none","--radio-background-color":"var(--ds-background-input, ".concat(s.QX,")"),"--radio-border-color":"var(--ds-border-input, ".concat(s.ay,")"),"--radio-dot-color":"var(--ds-icon-inverse, ".concat(s.QX,")"),"--radio-dot-opacity":0,transform:"scale(calc(7 / 12))",transition:"border-color 0.2s ease-in-out, background-color 0.2s ease-in-out",verticalAlign:"top",WebkitAppearance:"none","&::after":{width:"calc(4px * 12 / 7)",height:"calc(4px * 12 / 7)",position:"absolute",background:"var(--radio-dot-color)",borderRadius:"var(--ds-border-radius-circle, 50%)",content:"''",opacity:"var(--radio-dot-opacity)",transition:"background-color 0.2s ease-in-out, opacity 0.2s ease-in-out"},"&:hover":{"--radio-background-color":"var(--ds-background-input-hovered, ".concat(s.Wz,")"),"--radio-border-color":"var(--ds-border-input, ".concat(s.ay,")")},"&:active":{"--radio-background-color":"var(--ds-background-input-pressed, ".concat(s.Wz,")")},"&:focus":{outline:"var(--ds-border-width-outline, 3px)".concat(" solid ","var(--ds-border-focused, ".concat(s.P1,")")),outlineOffset:"var(--ds-border-width-indicator, 3px)"},"&:checked":{"--radio-background-color":"var(--ds-background-selected-bold, ".concat(s.zK,")"),"--radio-border-color":"var(--ds-background-selected-bold, ".concat(s.zK,")"),"--radio-dot-opacity":1},"&:checked:hover":{"--radio-background-color":"var(--ds-background-selected-bold-hovered, ".concat(s.gq,")"),"--radio-border-color":"var(--ds-background-selected-bold-hovered, ".concat(s.gq,")")},"&:checked:active":{"--radio-background-color":"var(--ds-background-selected-bold-pressed, ".concat(s.ec,")"),"--radio-border-color":"var(--ds-border-input, ".concat(s.ay,")"),"--radio-dot-color":"var(--ds-icon-inverse, ".concat(s.zK,")")},"&:checked:focus":{outline:"var(--ds-border-width-outline, 3px)".concat(" solid ","var(--ds-border-focused, ".concat(s.P1,")")),outlineOffset:"var(--ds-border-width-indicator, 3px)"},"&[data-invalid], &:checked[data-invalid]":{"--radio-border-color":"var(--ds-icon-danger, ".concat(s.w,")")},"&:disabled, &:disabled:hover, &:disabled:focus, &:disabled:active, &:disabled[data-invalid]":{cursor:"not-allowed","--radio-background-color":"var(--ds-background-disabled, ".concat(s.Zv,")"),"--radio-border-color":"var(--ds-border-disabled, ".concat(s.Zv,")"),"--radio-dot-color":"var(--ds-icon-disabled, ".concat(s.eT,")")}}),b=(0,i.forwardRef)((function(e,r){var a=e.ariaLabel,i=e.isDisabled,d=void 0!==i&&i,s=e.isRequired,b=e.isInvalid,v=void 0!==b&&b,x=e.isChecked,m=void 0!==x&&x,A=e.label,k=e.name,f=e.onChange,_=void 0===f?u:f,C=e.value,y=e.testId,j=e.analyticsContext,I=(0,n.A)(e,l),P=(0,c.D)({fn:_,action:"changed",analyticsData:j,componentName:"radio",packageName:"@atlaskit/radio",packageVersion:"6.5.4"});return(0,t.Y)("label",{"data-testid":y&&"".concat(y,"--radio-label"),"data-disabled":d?"true":void 0,css:g},(0,t.Y)("input",(0,o.A)({},I,{tabIndex:0,"aria-label":a,checked:m,disabled:d,name:k,onChange:P,required:s,type:"radio",value:C,"data-testid":y&&"".concat(y,"--radio-input"),"data-invalid":v?"true":void 0,css:h,ref:r})),A?(0,t.Y)("span",{css:p},A):null)}));const v=(0,i.memo)((0,i.forwardRef)((function(e,r){return(0,t.Y)(b,(0,o.A)({},e,{ref:r}))})))},74609:(e,r,a)=>{a.r(r),a.d(r,{default:()=>I});var o=a(47767),n=a(84976),i=a(43164),t=a(96540),c=a(49785),d=a(55551),s=a(97286),l=a(14638),u=a(58124),p=a(43045),g=a(15490),h=a(53857),b=a(52340),v=a(8290),x=a(20924),m=a(57464),A=a(17673),k=a(60659),f=a(5642),_=a(72288),C=a(12596),y=a(82568),j=a(74848);const I=()=>{const e=(0,o.Zp)(),[r,a]=((0,i.E)(),(0,t.useState)(!1)),[I,P]=(0,t.useState)("Api Integration"),[S]=(0,n.ok)(),{handleSubmit:R,control:w,getValues:E}=(0,c.mN)({defaultValues:async()=>{const e=await(0,d.l)((async e=>await e.ipcRenderer.invoke("GET_AUTH_PLUGIN_DATA")));return{client_id:e?.client_id||"",client_secret:e?.client_secret||"",apiIntegration:e?.access_token||"",redirect_uri:"MISSING_ENV_VAR".REDIRECT_URI||""}}}),T=(0,s.I)({queryKey:["checkConnectionPlugin"],queryFn:async e=>await l.J.get("/check-connection-plugin",{signal:e.signal,params:{namePlugin:u.RH.TEMPO,access_token:E("apiIntegration")}}),enabled:!1,notifyOnChangeProps:["isSuccess","isFetching"],retry:2}),D=(0,f.BL)({onSuccess:()=>{T.isSuccess&&(0,d.l)((async r=>{await r.ipcRenderer.invoke("SAVE_AUTH_DATA_PLUGIN",{access_token:E("apiIntegration"),namePlugin:u.RH.TEMPO}),e("/issues")}))}});(0,y.K)(D.error),(0,y.K)(T.error),(0,t.useEffect)((()=>{T.isSuccess&&D.mutate({settings:{plugin:u.RH.TEMPO}})}),[T.isSuccess]),(0,t.useEffect)((()=>()=>p.q.removeQueries({queryKey:["checkConnectionPlugin"]})),[]),(0,t.useEffect)((()=>{const e=(0,d.l)((e=>{const r=async(r,o)=>{try{a(!0);const r=await l.J.post("/oauth-token-plugin",{code:o});await e.ipcRenderer.invoke("SAVE_AUTH_DATA_PLUGIN",{access_token:r.data.access_token,refresh_token:r.data.refresh_token,client_id:E("client_id"),client_secret:E("client_secret"),namePlugin:u.RH.TEMPO}),a(!1)}catch(e){a(!1)}};return e.ipcRenderer.on("ACCEPT_OAuth2Plugin",r),()=>{e.ipcRenderer.removeListener("ACCEPT_OAuth2Plugin",r)}}));return()=>e()}),[]);return(0,j.jsxs)(g.A,{children:[(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.250"})}),(0,j.jsxs)(b.A,{justifyContent:"center",alignItems:"center",columnGap:"space.100",xcss:(0,h.S7)({marginBottom:"space.200"}),children:[(0,j.jsx)(v.A,{height:"35px",width:"35px",src:"https://static.tempo.io/io/non-versioned/img/tempo-logo.png",loading:"lazy"}),(0,j.jsx)(C.A,{size:"xxlarge",children:"Tempo"})]}),S.has("isUnauthorizedPlugin")&&(0,j.jsx)(_.A,{title:"Plugin Disconnected",appearance:"error",children:"The plugin has been disconnected from the application due to errors. Please log in to the plugin again to restore functionality."}),(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.200"})}),(0,j.jsxs)(b.A,{justifyContent:"end",children:[(0,j.jsx)(x.A,{value:"Api Integration",label:"Api Integration",isChecked:"Api Integration"===I,onChange:()=>P("Api Integration"),onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0}),(0,j.jsx)(x.A,{value:"OAuth2",label:"OAuth2",testId:"radio-disabled",isChecked:"OAuth2"===I,onChange:()=>P("OAuth2"),onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0})]}),"OAuth2"===I?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(m.JU,{htmlFor:"redirect_uri",children:"Redirect URIs:"}),(0,j.jsx)(c.xI,{render:e=>{let{field:a}=e;return(0,j.jsx)(A.A,{id:"redirect_uri",value:a.value,ref:a.ref,onChange:a.onChange,isDisabled:r})},name:"redirect_uri",control:w}),(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.200"})}),(0,j.jsx)(m.JU,{htmlFor:"client_id",children:"Client ID:"}),(0,j.jsx)(c.xI,{render:e=>{let{field:a}=e;return(0,j.jsx)(A.A,{id:"client_id",value:a.value,ref:a.ref,onChange:a.onChange,isDisabled:r})},name:"client_id",control:w}),(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.200"})}),(0,j.jsx)(m.JU,{htmlFor:"client_secret",children:"Client secret:"}),(0,j.jsx)(c.xI,{render:e=>{let{field:a}=e;return(0,j.jsx)(A.A,{id:"client_secret",value:a.value,ref:a.ref,onChange:a.onChange,isDisabled:r})},name:"client_secret",control:w}),(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.200"})}),(0,j.jsx)(k.A,{isLoading:r,onClick:R((e=>{(0,d.l)((async r=>{const a=await r.ipcRenderer.invoke("GET_AUTH_DATA"),o=new URL(`${a.jiraSubDomain}/plugins/servlet/ac/io.tempo.jira/oauth-authorize/`);o.searchParams.set("client_id",e.client_id),o.searchParams.set("redirect_uri",e.redirect_uri),a.jiraSubDomain&&r.ipcRenderer.send("OPEN_OAuth2Plugin",{url:o.toString(),redirect_uri:e.redirect_uri})}))})),appearance:"primary",shouldFitContainer:!0,children:"Connect"})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(m.JU,{htmlFor:"apiIntegration",children:"API Integration:"}),(0,j.jsx)(c.xI,{render:e=>{let{field:a}=e;return(0,j.jsx)(A.A,{id:"apiIntegration",value:a.value,onChange:a.onChange,ref:a.ref,isDisabled:r})},name:"apiIntegration",control:w}),(0,j.jsx)(g.A,{xcss:(0,h.S7)({marginBottom:"space.200"})}),(0,j.jsx)(k.A,{isLoading:r||T.isFetching||D.isPending,onClick:R((()=>T.refetch())),appearance:"primary",shouldFitContainer:!0,children:"Connect"})]})]})}}}]);