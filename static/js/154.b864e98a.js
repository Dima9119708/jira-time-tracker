"use strict";(self.webpackChunkjira_time_tracker=self.webpackChunkjira_time_tracker||[]).push([[154],{88811:(e,t,s)=>{s.d(t,{f5:()=>a.f,dP:()=>g,_R:()=>p,DL:()=>m,Rn:()=>x,RY:()=>r});const r=e=>({comment:{type:"doc",version:1,content:[{type:"paragraph",content:[{type:"text",text:e}]}]}});var a=s(5800),n=s(57097),i=s(58124),o=s(14638),c=s(74353),d=s.n(c),l=s(35806),u=s(43045);const p=e=>{const t=(0,i.QN)((e=>e.settings.workingDaysPerWeek)),s=(0,i.QN)((e=>e.settings.workingHoursPerDay));return(0,n.n)({mutationKey:e?.mutationKey,mutationFn:async n=>{await(e?.prefetch?.());if(i.QN.getState().settings.plugin===i.RH.TEMPO){const e=u.q.getQueryData(["myself"]);return await o.J.post("/issue-worklog/plugin",{issueId:n.issueId,timeSpentSeconds:n.timeSpentSeconds||(0,a.f)(n.timeSpent,t,s),startDate:d()(n.startDate).format(l.D),authorAccountId:e.accountId,description:n.description})}return await o.S.post("/issue-worklog",{issueId:n.issueId,started:d()(n.startDate).format("YYYY-MM-DDTHH:mm:ss.SSSZZ"),timeSpentSeconds:n.timeSpentSeconds||(0,a.f)(n.timeSpent,t,s),...r(n.description||"")})},...e})},m=e=>{const t=(0,i.QN)((e=>e.settings.workingDaysPerWeek)),s=(0,i.QN)((e=>e.settings.workingHoursPerDay));return(0,n.n)({mutationFn:async n=>{await(e?.prefetch?.());if(i.QN.getState().settings.plugin===i.RH.TEMPO){const e=u.q.getQueryData(["myself"]);return await o.J.put("/issue-worklog/plugin",{id:n.id,startDate:d()(n.startDate).format(l.D),authorAccountId:e.accountId,timeSpentSeconds:n.timeSpentSeconds||(0,a.f)(n.timeSpent,t,s),...void 0!==n.description&&{description:n.description}})}return await o.S.put("/issue-worklog",{issueId:n.issueId,id:n.id,started:d()(n.startDate).format("YYYY-MM-DDTHH:mm:ss.SSSZZ"),timeSpentSeconds:n.timeSpentSeconds||(0,a.f)(n.timeSpent,t,s),...void 0!==n.description&&r(n.description)})},...e})},g=e=>(0,n.n)({mutationFn:async t=>{await(e?.prefetch?.());return i.QN.getState().settings.plugin===i.RH.TEMPO?await o.J.delete("/issue-worklog/plugin",{params:{id:t.id}}):await o.S.delete("/issue-worklog",{params:{issueId:t.issueId,id:t.id}})},...e});var h=s(97665),f=s(97286),y=s(53341);const x=e=>{let{issueId:t,to:s,from:r,enabled:n,prefetch:c}=e;const u=(0,h.jE)();return(0,f.I)({enabled:n,queryKey:["issue worklogs",t,s,r],queryFn:async e=>{let{signal:n}=e;await(c?.());if(i.QN.getState().settings.plugin===i.RH.TEMPO){const e=u.getQueryData(["myself"]);return(await o.J.post("/worklogs/plugin",{issueIds:[t],authorIds:[e.accountId],orderBy:[{field:"START_DATE_TIME",order:"DESC"}],...r&&{from:d()(r).format(l.D)},...s&&{to:d()(s).format(l.D)}},{signal:n})).data.results.map((t=>({id:t.tempoWorklogId.toString(),timeSpent:(0,a.j)(t.timeSpentSeconds,i.QN.getState().settings.workingDaysPerWeek,i.QN.getState().settings.workingHoursPerDay),timeSpentSeconds:t.timeSpentSeconds,description:t.description||"==//==",author:{displayName:e.displayName,avatarUrls:e.avatarUrls,accountId:e.accountId},date:t.startDate})))}{const e=u.getQueryData(["myself"]),a=await o.S.get("/issue-worklogs",{params:{issueId:t},signal:n}),i=d()(r),c=d()(s);return a.data.worklogs.reduce(((t,a)=>{const n=d()(a.started),o=d()(a.created);return a.author.accountId===e.accountId&&(r&&s&&n.isSameOrAfter(i)&&n.isSameOrBefore(c)&&t.push({id:a.id,timeSpent:a.timeSpent,timeSpentSeconds:a.timeSpentSeconds,description:(0,y.d)(a.comment).trim()||"==//==",author:{displayName:e.displayName,avatarUrls:e.avatarUrls,accountId:e.accountId},date:n.format(l.D),dateCreated:o}),r||s||t.push({id:a.id,timeSpent:a.timeSpent,timeSpentSeconds:a.timeSpentSeconds,description:(0,y.d)(a.comment),author:{displayName:e.displayName,avatarUrls:e.avatarUrls,accountId:e.accountId},date:n.format(l.D),dateCreated:o})),t}),[]).sort(((e,t)=>t.dateCreated.isBefore(e.date)?1:-1)).map((t=>({id:t.id,timeSpent:t.timeSpent,timeSpentSeconds:t.timeSpentSeconds,description:t.description,author:{displayName:e.displayName,avatarUrls:e.avatarUrls,accountId:e.accountId},date:t.date})))}}})}},5800:(e,t,s)=>{s.d(t,{f:()=>r,j:()=>a});const r=(e,t,s)=>{const r=e.match(/(\d+w)|(\d+d)|(\d+h)|(\d+m)/g);let a=0;return r?(r.forEach((e=>{const r=parseInt(e.slice(0,-1));switch(e.slice(-1)){case"w":a+=r*t*s*60*60;break;case"d":a+=r*s*60*60;break;case"h":a+=60*r*60;break;case"m":a+=60*r}})),a):a},a=(e,t,s)=>{const r=3600,a=r*s,n=a*t;let i=e;const o=Math.floor(i/n);i%=n;const c=Math.floor(i/a);i%=a;const d=Math.floor(i/r);i%=r;const l=Math.floor(i/60),u=[];return o&&u.push(`${o}w`),c&&u.push(`${c}d`),d&&u.push(`${d}h`),l&&u.push(`${l}m`),u.join(" ")}},45366:(e,t,s)=>{s.d(t,{qF:()=>l,Ke:()=>I,FT:()=>w,iq:()=>Q,mc:()=>U.mc,uK:()=>U.uK,w5:()=>M,gJ:()=>q,HM:()=>R,ye:()=>F});var r=s(53857),a=s(15490),n=s(96540);var i=s(74848);const o=["color.border.accent.lime","color.border.accent.orange","color.border.accent.yellow","color.border.accent.green","color.border.accent.teal","color.border.accent.blue","color.border.accent.purple"],c=e=>{let{active:t,borderColor:s}=e;return(0,r.S7)({display:"flex",flexDirection:"column",rowGap:"space.200",padding:"space.200",borderRadius:"border.radius.200",boxShadow:"elevation.shadow.overflow",backgroundColor:"color.background.input",...t&&{borderWidth:"border.width.outline",borderStyle:"solid",borderColor:s},marginBottom:"space.250","&:last-child":{marginBottom:0}})},d=e=>{const{children:t,active:s}=e,r=(0,n.useMemo)((()=>{if(s)return function(e){if(0===e.length)return;return e[Math.floor(Math.random()*e.length)]}(o)}),[s]);return(0,i.jsx)(a.A,{xcss:c({active:s,borderColor:r}),children:t})},l=(0,n.memo)(d);var u=s(52340),p=s(88764),m=s(12596),g=s(51144),h=s(24681),f=s(84017),y=s(74353),x=s.n(y),S=s(35806),j=s(58124);const k=(0,n.memo)((e=>{const{fields:t}=e,{summary:s,timespent:o,timeoriginalestimate:c,duedate:d}=t,l=(0,j.QN)((e=>e.settings.storyPointField)),y=(0,j.QN)((e=>e.settings.useStoryPointsAsTimeEstimate)),k=t[l],w=(0,n.useMemo)((()=>{const e={due:null,timespent:"",timeoriginalestimate:""};if(x()(d).isValid()){const t=x()(),s=x()(d).diff(t,"minute"),r=s<0,a=Math.abs(s),n=a%60,i=`${r?"-":""}${Math.floor(a/60).toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}h`;e.due={formattedTime:i,isOverdue:r,originalTime:x()(d).format(S.D)}}if(!y&&l in t&&(e.storyPoint=k),e.timespent=(0,h.M)(o),y)if("number"==typeof k){const t=x().duration(k,"hours").asSeconds();e.timeoriginalestimate=(0,h.M)(t)}else e.timeoriginalestimate="-";else e.timeoriginalestimate=c?(0,h.M)(c):"-";return e}),[o,c,d,k,l,y]);return(0,i.jsxs)(u.A,{justifyContent:"space-between",children:[(0,i.jsx)(a.A,{xcss:(0,r.S7)({marginRight:"space.200"}),children:(0,i.jsx)(m.A,{size:"medium",children:s})}),(0,i.jsxs)(u.A,{gap:"space.100",direction:"column",alignItems:"end",xcss:(0,r.S7)({flexShrink:"0"}),children:[w.storyPoint&&(0,i.jsx)(g.A,{children:(0,i.jsxs)(u.A,{columnGap:"space.075",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:"Story point estimate",children:e=>(0,i.jsx)("span",{...e,children:"Story point:"})})}),(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:"Story point estimate",children:e=>(0,i.jsx)("span",{...e,children:w.storyPoint})})})]})}),w.due&&(0,i.jsx)(g.A,{appearance:w.due.isOverdue?"removed":"default",children:(0,i.jsxs)(u.A,{columnGap:"space.075",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:"Due date",children:e=>(0,i.jsx)("span",{...e,children:"Due:"})})}),(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:`${w.due.isOverdue?"Overdue":"Due"}: ${w.due.originalTime}`,children:e=>(0,i.jsx)("span",{...e,children:w.due?.formattedTime})})})]})}),(0,i.jsx)(g.A,{children:(0,i.jsxs)(u.A,{columnGap:"space.075",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:"Logged",children:e=>(0,i.jsx)("span",{...e,children:w.timespent})})}),(0,i.jsx)(p.A,{weight:"medium",size:"large",children:"|"}),(0,i.jsx)(p.A,{weight:"medium",size:"large",children:(0,i.jsx)(f.A,{content:"Original estimate",children:e=>(0,i.jsx)("span",{...e,children:w.timeoriginalestimate})})})]})})]})]})})),w=(0,n.memo)(k);var A=s(8290);const b={badgeInner:(0,r.S7)({padding:"space.050",textTransform:"uppercase",alignItems:"center",columnGap:"space.075"})},v=e=>{const{priorityIconUrl:t,issueKey:s,priorityName:r,projectName:a,avatarUrl:o,issueTypeIconUrl:c,issueTypeName:d,created:l}=e,m=(0,n.useMemo)((()=>({relativeTimeString:x()(l).fromNow(),exactDate:x()(l).format("YYYY-MM-DD HH:mm:ss")})),[l]);return(0,i.jsxs)(u.A,{gap:"space.100",alignItems:"center",wrap:"wrap",children:[(0,i.jsx)(g.A,{appearance:"default",children:(0,i.jsxs)(u.A,{xcss:b.badgeInner,children:[(0,i.jsx)(A.A,{src:o,height:"15px",width:"15px"}),(0,i.jsxs)(p.A,{weight:"bold",size:"small",children:["Project: ",a]})]})}),(0,i.jsx)(g.A,{appearance:"default",children:(0,i.jsxs)(u.A,{xcss:b.badgeInner,children:[(0,i.jsx)(A.A,{src:t,height:"15px",width:"15px"}),(0,i.jsxs)(p.A,{weight:"bold",size:"small",children:["priority: ",r]})]})}),(0,i.jsx)(g.A,{appearance:"default",children:(0,i.jsxs)(u.A,{xcss:b.badgeInner,children:[(0,i.jsx)(A.A,{src:c,height:"15px",width:"15px"}),(0,i.jsxs)(p.A,{weight:"bold",size:"small",children:[d," (",s,")"]})]})}),(0,i.jsx)(g.A,{appearance:"default",children:(0,i.jsx)(f.A,{content:m.exactDate,children:(0,i.jsxs)(p.A,{weight:"bold",size:"small",children:["CREATED: ",m.relativeTimeString]})})})]})},I=(0,n.memo)(v);var C=s(5542),D=s(81609),E=s(31519),P=s(12828),T=s(97286),N=s(14638);const M=e=>{const{issueId:t,onChange:s,trigger:r,status:o,position:c="bottom-start",disabled:d,xcss:l,isPending:u}=e,[p,m]=(0,n.useState)(!1),{data:g,isLoading:h}=(e=>{let{issueId:t,open:s}=e;return(0,T.I)({queryKey:["statuses task",t],queryFn:()=>N.S.get("/statuses-task",{params:{id:t}}),select:e=>e.data,enabled:s})})({issueId:t,open:p});return(0,i.jsx)(a.A,{xcss:l,children:(0,i.jsx)(D.A,{isLoading:h,isOpen:!0!==d&&p,onOpenChange:()=>m(!p),placement:c,trigger:"string"==typeof r?r:e=>r(e,u),children:(0,i.jsx)(E.A,{children:!h&&g?.transitions.map((e=>{const t="new"===e.to.statusCategory.key&&"default",r="indeterminate"===e.to.statusCategory.key&&"inprogress",a="done"===e.to.statusCategory.key&&"success",n=t||r||a||"default";return(0,i.jsx)(P.A,{onClick:()=>s(e),isSelected:o.id===e.to.id,children:(0,i.jsx)(C.A,{appearance:n,children:e.name})},e.id)}))})})})},F=e=>(0,n.useMemo)((()=>{const t="new"===e.status.statusCategory.key&&"default",s="indeterminate"===e.status.statusCategory.key&&"primary",a="done"===e.status.statusCategory.key&&"subtle";return{STATUTES_DROPDOWN_BUTTON:(0,r.S7)({"& > button":{fontWeight:"var(--ds-font-weight-semibold, 600)",...t&&{backgroundColor:"var(--ds-background-neutral, #091E420F)",color:"var(--ds-text, #172B4D)"},...s&&{backgroundColor:"var(--ds-background-information-bold, #0C66E4)",color:"var(--ds-text-inverse, #FFFFFF)"},...a&&{backgroundColor:"var(--ds-chart-success-bold, #216E4E)",color:"var(--ds-text-inverse, #FFFFFF)"}},"& > button:hover":{...t&&{backgroundColor:"var(--ds-background-neutral-hovered, #091E4224)",color:"var(--ds-text, #172B4D)"},...s&&{backgroundColor:"var(--ds-background-information-bold-hovered, #0055CC)",color:"var(--ds-text-inverse, #FFFFFF)"},...a&&{backgroundColor:"var(--ds-chart-success-bold-hovered, #164B35)",color:"var(--ds-text-inverse, #FFFFFF)"}}})}}),[e.status.name]),R=e=>(0,T.I)({queryKey:["issues tracking"],queryFn:async t=>{const s=j.QN.getState().getIssueIdsSearchParams();if(s){const r=s.split(",");return(await Promise.allSettled([N.S.get("/issues",{params:{jql:`issue in (${r.join(",")})`,maxResults:r.length},signal:t.signal})])).reduce(((t,s)=>{if("fulfilled"===s.status&&t.push(...s.value.data.issues),"rejected"===s.status){const t=s.reason;j.QN.getState().changeIssueIdsSearchParams("delete",s.reason.config.params.id),e.onReject&&e.onReject(t)}return t}),[])}return[]}});var O=s(6475);const q=e=>{const{onFilteringIssues:t,queryKey:s=["issues"],jql:r,maxResults:a=20,...n}=e;return(0,O.q)({queryKey:s,queryFn:async e=>{const s=a,n=await N.S.get("/issues",{params:{jql:"function"==typeof r?r():r,startAt:e.pageParam*s,maxResults:s},signal:e.signal});return"function"==typeof t?t(n.data):n.data},getNextPageParam:(e,t,s,r)=>e.issues.length>0?s+1:null,initialPageParam:0,enabled:n.enabled,gcTime:n.gcTime})};var K=s(60659);const L=e=>{const{isShowLinkedIssues:t,isShowChildIssues:s,countLinkedIssues:r,countChildIssues:a}=e,[o,c]=(0,n.useState)(!1);return t||s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{columnGap:"space.100",children:[t&&(0,i.jsxs)(K.A,{spacing:"compact",isSelected:"Linked issues"===o,onClick:()=>c((e=>"Linked issues"!==e&&"Linked issues")),children:["Linked issues (",r,")"]}),s&&(0,i.jsxs)(K.A,{spacing:"compact",isSelected:"Child issues"===o,onClick:()=>c((e=>"Child issues"!==e&&"Child issues")),children:["Child issues (",a,")"]})]}),e.children({activityFeed:o})]}):null},Q=(0,n.memo)(L);var U=s(53049)},53049:(e,t,s)=>{s.d(t,{Ay:()=>l,BX:()=>d,mc:()=>c,uK:()=>o});var r=s(53857),a=s(15490),n=(s(96540),s(74848));const i={root:(0,r.S7)({display:"flex",flexDirection:"column",gap:"space.100",paddingTop:"space.100",paddingBottom:"space.100"}),issuesWrap:(0,r.S7)({boxShadow:"elevation.shadow.raised",borderRadius:"border.radius.100"}),wrap:(0,r.S7)({display:"grid",gridTemplateColumns:"20px auto auto 1fr auto auto auto auto auto",alignItems:"center",padding:"space.100",columnGap:"space.100",rowGap:"space.100",borderBottomWidth:"border.width",borderBottomStyle:"solid",borderBottomColor:"color.border","&:last-child":{borderBottom:"none"}}),element:(0,r.S7)({}),key:(0,r.S7)({color:"color.text.accent.blue"}),fullWidth:(0,r.S7)({gridColumn:"1 / -1"}),summary:(0,r.S7)({paddingRight:"space.100",paddingLeft:"space.100",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"})},o=e=>(0,n.jsx)(a.A,{xcss:i.issuesWrap,children:e.children}),c=e=>(0,n.jsx)(a.A,{xcss:i.root,children:e.children}),d=e=>(0,n.jsx)("div",{style:{paddingLeft:e.marginLeft,paddingRight:"var(--ds-space-100, 8px)",borderBottomStyle:"solid",borderBottomWidth:"var(--ds-border-width, 1px)",borderBottomColor:"var(--ds-border, #091E4224)"},children:e.children}),l=e=>{const{iconSlot:t,typeSlot:s,keySlot:r,playerSlot:o,favoriteSlot:c,prioritySlot:d,summarySlot:l,statusSlot:u,assigneeSlot:p}=e;return(0,n.jsxs)(a.A,{xcss:i.wrap,children:[(0,n.jsx)(a.A,{xcss:i.element,children:t}),(0,n.jsx)(a.A,{xcss:i.element,children:s}),(0,n.jsx)(a.A,{xcss:i.key,children:r}),(0,n.jsx)(a.A,{xcss:i.summary,children:l}),(0,n.jsx)(a.A,{xcss:i.element,children:c}),(0,n.jsx)(a.A,{xcss:i.element,children:d}),(0,n.jsx)(a.A,{xcss:i.element,children:p}),(0,n.jsx)(a.A,{xcss:i.element,children:u}),(0,n.jsx)(a.A,{xcss:i.element,children:o})]})}},53341:(e,t,s)=>{s.d(t,{d:()=>r});const r=e=>{if(void 0===e)return"";let t="";return"text"===e.type&&"text"in e&&(t+=` ${e.text}`),e.content&&e.content.forEach((e=>{t+=r(e)})),t}},15208:(e,t,s)=>{s.d(t,{q:()=>k,d:()=>q});var r=s(17673),a=s(96540),n=s(97665),i=s(97286),o=s(14638),c=s(42361),d=s(86925),l=s(64561),u=s(15490),p=s(53857),m=s(20181),g=s.n(m),h=s(67459),f=s(82568),y=s(90839),x=s(87165),S=s(74848);const j=e=>{const{onChange:t,width:s="40%",value:m="",isShowExpanded:j=!0}=e,[k,w]=(0,a.useState)(m),[A,b]=(0,a.useState)(m),[v,I]=(0,a.useState)(!1),C=(0,n.jE)(),{refetch:D,isFetching:E,data:P,error:T}=(0,i.I)({queryKey:["searchIssues"],queryFn:async e=>{let{signal:s}=e;if(""===k)return t({issueIds:[],value:""}),1;const r=(await o.S.get("/issue/picker",{params:{currentJQL:'project in projectsWhereUserHasPermission("Work on issues")',showSubTasks:!0,showSubTaskParent:!0,query:k},signal:s})).data.sections.reduce(((e,t)=>(e.push(...t.issues.map((e=>e.id))),e)),[]),a=new Set(r);return t({issueIds:Array.from(a.values()),value:k}),a.size},enabled:!1,gcTime:0});(0,f.K)(T),(0,a.useEffect)((()=>{const e=g()((()=>{k!==A&&(D(),b(k))}),500);return e(),()=>{e.cancel()}}),[k,A,D]),(0,a.useEffect)((()=>{""===m&&(w(""),C.removeQueries({queryKey:["searchIssues"]}))}),[m]);const N=(0,a.useCallback)((e=>{w(e.currentTarget.value)}),[]);return(0,S.jsx)(u.A,{xcss:(0,p.S7)({width:v?"100%":s}),children:(0,S.jsx)(r.A,{isInvalid:0===P,isCompact:!0,elemBeforeInput:0===P?(0,S.jsx)(x.default,{label:"search issues",primaryColor:"var(--ds-text-danger, #AE2E24)"}):(0,S.jsx)(c.default,{label:"search issues"}),elemAfterInput:j&&(0,S.jsx)(l.A,{onClick:()=>{if(!E)return k.length>0?w(""):void I((e=>!e))},icon:k?y.A:E?h.A:d.A,label:"search issues expand"}),value:k,placeholder:"Search issues",onChange:N})})},k=(0,a.memo)(j);var w=s(52340),A=s(88764),b=s(8290),v=s(6785),I=s(18720),C=s(44531),D=s(45366),E=s(96077),P=s(12828),T=s(85692),N=s(60659);const M={wrap:(0,p.S7)({wordBreak:"break-all",backgroundColor:"color.background.input",padding:"space.050",paddingLeft:"space.100",borderWidth:"1px",borderRadius:"border.radius.100",borderStyle:"solid",borderColor:"color.border.input",cursor:"pointer"}),content:(0,p.S7)({padding:"space.200"}),wrapIssues:(0,p.S7)({marginTop:"space.100",paddingBottom:"space.300",maxHeight:"300px",overflow:"auto"})},F=(0,a.memo)((e=>(0,S.jsx)(P.A,{isSelected:e.isSelected,onClick:()=>e.onSelect(e.issueKey),children:(0,S.jsxs)(w.A,{alignItems:"start",columnGap:"space.150",children:[(0,S.jsx)(b.A,{src:e.iconUrl}),(0,S.jsxs)(w.A,{direction:"column",children:[(0,S.jsx)(A.A,{children:e.issueKey}),(0,S.jsx)(A.A,{color:"color.text.accent.gray",children:e.summary})]})]})}))),R=e=>{const{issueKey:t,onChange:s}=e,{ref:r,inView:i}=(0,T.Wx)(),[o,c]=(0,a.useState)(""),d=(0,n.jE)(),l=(0,D.gJ)({queryKey:["search issues",o],jql:o,maxResults:8});(0,f.K)(l.error),(0,a.useEffect)((()=>{i&&!l.isFetching&&l.fetchNextPage()}),[i,l.isFetching]);const m=(0,a.useCallback)((e=>{c(e.issueIds.length?`issue in (${e.issueIds.join(",")})`:"")}),[]),g=(0,a.useCallback)((t=>{const r=d.getQueryData(["search issues",o]);if(r)for(const a of r.pages){const r=a.issues.find((e=>{let{key:s}=e;return s===t}));if(r){d.setQueryData(["issue",r.id],r),s(r),e.onClose?.();break}}}),[o]);return(0,S.jsxs)(u.A,{xcss:M.content,children:[(0,S.jsx)(k,{onChange:m,width:"100%",isShowExpanded:!1}),(0,S.jsxs)(u.A,{xcss:M.wrapIssues,children:[l.isLoading&&(0,S.jsx)(E.A,{header:"",description:(0,S.jsx)(h.A,{})}),l.data?.pages.map((e=>e.issues.map((e=>(0,S.jsx)(F,{issueKey:e.key,iconUrl:e.fields.issuetype.iconUrl,summary:e.fields.summary,onSelect:g,isSelected:e.key===t},e.id))))),(0,S.jsx)(u.A,{xcss:(0,p.S7)({marginTop:"space.300"})}),(0,S.jsxs)(N.A,{appearance:l.isFetchingNextPage?"default":l.hasNextPage?"primary":"default",onClick:()=>l.fetchNextPage(),shouldFitContainer:!0,children:[l.isFetchingNextPage?"Loading more...":l.hasNextPage?"Load More":"Nothing more to load",(0,S.jsx)(u.A,{ref:r,xcss:(0,p.S7)({display:l.isFetchingNextPage?"none":"block"})})]})]})]})},O=e=>{const{issueId:t,onChange:s,placement:r="bottom-start"}=e,[n,c]=(0,a.useState)(!1),d=(0,i.I)({queryKey:["issue",t],queryFn:async e=>(await o.S.get("/issue",{params:{id:t},signal:e.signal})).data,enabled:!!t});(0,f.K)(d.error);const l=d.data?.fields?.issuetype.iconUrl||"",p=d.data?.key||"",m=d.data?.fields?.summary||"";return(0,S.jsx)(C.z,{isOpen:n,onClose:()=>c(!1),placement:r,shouldRenderToParent:!0,shouldFitContainer:!0,content:()=>n&&(0,S.jsx)(R,{onChange:s,issueKey:p,onClose:()=>c(!1)}),trigger:e=>(0,S.jsx)(u.A,{...e,xcss:M.wrap,onClick:()=>c((e=>!e)),children:(0,S.jsxs)(w.A,{justifyContent:"space-between",alignItems:"center",children:[!d.isLoading&&d.data&&(0,S.jsxs)(w.A,{columnGap:"space.100",children:[(0,S.jsx)(b.A,{src:l}),(0,S.jsxs)(A.A,{children:[p," · ",m]})]}),d.isLoading&&(0,S.jsx)(A.A,{children:"Loading..."}),!d.isLoading&&!d.data&&(0,S.jsx)(A.A,{children:"No issue selected"}),n?(0,S.jsx)(I.A,{label:"dropdown arrow"}):(0,S.jsx)(v.default,{label:"dropdown arrow"})]})})})},q=(0,a.memo)(O)},97066:(e,t,s)=>{s.d(t,{r:()=>S});var r=s(97665),a=s(97286),n=s(14638),i=s(58124),o=s(5800),c=s(74353),d=s.n(c),l=s(53341),u=s(35806);var p=s(88811),m=s(43164),g=s(5642),h=s(96540),f=s(82568),y=s(12129),x=function(e){return e.JIRA="JIRA",e.TEMPO="is.origo.jira.tempo-plugin__timetracking-provider",e}(x||{});const S=e=>{const{from:t,to:s,enabledGetWorklogs:c=!0,enabledGetIssueWorklogs:S=!1,issueId:j="",enabledAllNotifications:k=!0,mutationGcTime:w=0}=e,A=(0,r.jE)(),b=(0,m.E)(),v=(0,g.BL)({titleLoading:" "}),I=(0,f.K)(),C=(0,y.b)(),D=(0,a.I)({queryKey:["time tracking provider"],queryFn:async e=>{const[t]=await Promise.allSettled([n.S.get("/configuration-timetracking-provider",{signal:e.signal})]);if("fulfilled"===t.status){if(t.value.data.key===x.JIRA)return null;if(t.value.data.key===x.TEMPO)return i.RH.TEMPO}if("rejected"===t.status&&403!==t.reason.response.status)throw new Error(JSON.stringify(t.reason.response.data));return 403},enabled:!0,staleTime:18e5,notifyOnChangeProps:["isStale"]}),E=(0,h.useCallback)((async e=>{e!==i.QN.getState().settings.plugin&&403!==e&&await v.mutateAsync({settings:{plugin:e}}),403===e&&i.QN.setState((e=>{e.hasJiraTimeTrackingPermission=!1}))}),[]),P=(0,h.useCallback)((async()=>{if(!D.isStale)return;const e=await D.refetch();await E(e.data)}),[D.isStale,E]);(0,h.useEffect)((()=>{D.isPending||E(D.data)}),[E,D.isPending,D.data]);const T=(e=>{let{to:t,from:s,prefetch:c,enabled:p}=e;const m=(0,r.jE)();return(0,a.I)({enabled:p,queryKey:["worklogs",t,s],queryFn:async e=>{if(await(c?.()),i.QN.getState().settings.plugin===i.RH.TEMPO){const r=m.getQueryData(["myself"]),a=await n.J.post("/worklogs/plugin",{authorIds:[r.accountId],from:d()(s).format(u.D),to:d()(t).format(u.D),orderBy:[{field:"START_DATE_TIME",order:"DESC"}]},{signal:e.signal}),c=new Set(a.data.results.map((e=>e.issue.id)));if(0===c.size)return[];const l=await n.S.get("/issues",{params:{jql:`issue in (${Array.from(c.values()).join(",")})`,startAt:0,maxResults:c.size},signal:e.signal}),p=a.data.results.map((e=>{const t=l.data.issues.find((t=>t.id===`${e.issue.id}`));return{id:e.tempoWorklogId.toString(),timeSpent:(0,o.j)(e.timeSpentSeconds,i.QN.getState().settings.workingDaysPerWeek,i.QN.getState().settings.workingHoursPerDay),timeSpentSeconds:e.timeSpentSeconds,issue:{icon:t.fields.issuetype.iconUrl,summary:t.fields.summary,id:t.id,key:t.key},project:{name:t.fields.project.name,avatarUrl:t.fields.project.avatarUrls["48x48"]},description:e.description.trim()||"==//==",author:{displayName:r.displayName,avatarUrls:r.avatarUrls,accountId:r.accountId},date:e.startDate}}));return Object.entries(Object.groupBy(p,(e=>e.project.name)))}{const r=m.getQueryData(["myself"]),a=(await n.S.post("/worklogs",{jql:`worklogDate >= "${d()(s).format(u.D)}" AND worklogDate <= "${d()(t).format(u.D)}" AND worklogAuthor = currentUser()`,fields:["summary","status","issuetype","worklog","project"]},{signal:e.signal})).data.issues.reduce(((e,a)=>(a.fields.worklog.worklogs.forEach((n=>{const i=d()(n.started);n.author.accountId===r.accountId&&i.isSameOrAfter(s)&&i.isSameOrBefore(t)&&e.push({id:n.id,timeSpent:n.timeSpent,timeSpentSeconds:n.timeSpentSeconds,issue:{icon:a.fields.issuetype.iconUrl,summary:a.fields.summary,id:a.id,key:a.key},project:{name:a.fields.project.name,avatarUrl:a.fields.project.avatarUrls["48x48"]},description:(0,l.d)(n.comment).trim()||"==//==",author:{displayName:n.author.displayName,avatarUrls:n.author.avatarUrls,accountId:n.author.accountId},date:i.format(u.D),dateCreated:i})})),e)),[]).sort(((e,t)=>t.dateCreated.isBefore(e.date)?1:-1));return Object.entries(Object.groupBy(a,(e=>e.project.name)))}}})})({from:t,to:s,prefetch:P,enabled:c}),N="mutation worklog",M=(0,p.Rn)({from:t,to:s,issueId:j,prefetch:P,enabled:S}),F=(0,p._R)({gcTime:w,mutationKey:[N],prefetch:P,onMutate:t=>"function"==typeof e.post?.onMutate?e.post?.onMutate?.(t):b.loading({title:"Worklog issue"}),onSuccess:(t,s,r)=>{"function"!=typeof e.post?.onMutate&&r?.(),k&&C(t),e.post?.onSuccess?.(s),c&&T.refetch(),S&&M.refetch()},onError:(t,s,r)=>{"function"!=typeof e.post?.onMutate&&r?.(),"function"==typeof e.post?.onError&&e.post?.onError?.(t,s,r),k&&I(t),c&&T.refetch(),S&&M.refetch()}}),R=(0,p.DL)({gcTime:w,mutationKey:[N],prefetch:P,onMutate:t=>"function"==typeof e.put?.onMutate?e.put?.onMutate(t):b.loading({title:"Worklog issue"}),onSuccess:(t,s,r)=>{"function"!=typeof e.put?.onMutate&&r?.(),k&&C(t),e.put?.onSuccess?.(s),c&&T.refetch(),S&&M.refetch()},onError:(t,s,r)=>{"function"!=typeof e.put?.onMutate&&r?.(),"function"==typeof e.put?.onError&&e.put?.onError?.(t,s,r),k&&I(t),c&&T.refetch(),S&&M.refetch()}}),O=(0,p.dP)({gcTime:w,mutationKey:[N],prefetch:P,onMutate:t=>"function"==typeof e.delete?.onMutate?e.delete?.onMutate?.(t):b.loading({title:"Worklog issue"}),onSuccess:(t,s,r)=>{"function"!=typeof e.delete?.onMutate&&r?.(),k&&C(t),e.delete?.onSuccess?.(s),c&&!1!==s.customFields?.isRefetchWorklogsAfterDelete&&T.refetch(),S&&!1!==s.customFields?.isRefetchWorklogsAfterDelete&&M.refetch()},onError:(t,s,r)=>{"function"!=typeof e.delete?.onMutate&&r?.(),"function"==typeof e.delete?.onError&&e.delete?.onError?.(t,s,r),k&&I(t),c&&T.refetch(),S&&M.refetch()}}),q=(0,h.useCallback)((()=>{const e=A.getMutationCache(),t=e.findAll({mutationKey:[N]});for(const s of t)e.remove(s);return t.length>0}),[N]);return{worklogPOST:F,worklogDELETE:O,worklogPUT:R,worklogs:T,issueWorklogs:M,wasMutationSuccessfulAndCacheCleared:q}}},3973:(e,t,s)=>{s.d(t,{w:()=>m});var r=s(44531),a=s(60659),n=s(64561),i=s(90585),o=s(15490),c=s(53857),d=s(88764),l=s(52340),u=s(96540),p=s(74848);const m=e=>{const{icon:t=i.A,children:s}=e,[m,g]=(0,u.useState)(!1),h=(0,u.useRef)(null),f=(0,u.useRef)(null);return(0,u.useEffect)((()=>{if(m&&e.id&&e.stopPropagation){const t=new AbortController,s=document.getElementById(e.id);return s&&(s.addEventListener("click",(e=>{e.stopImmediatePropagation()}),{signal:t.signal}),f.current&&f.current.addEventListener("click",(t=>{g(!1),e.onYes?.()}),{signal:t.signal}),h.current&&h.current.addEventListener("click",(t=>{g(!1),e.onNo?.()}),{signal:t.signal})),()=>{t.abort()}}}),[m]),(0,p.jsx)(r.z,{id:e.id,isOpen:m,onClose:()=>g(!1),shouldRenderToParent:!0,content:()=>(0,p.jsxs)(o.A,{xcss:(0,c.S7)({padding:"space.150"}),children:[(0,p.jsx)(d.A,{size:"large",children:e.title}),(0,p.jsx)(o.A,{xcss:(0,c.S7)({marginBottom:"space.100"})}),(0,p.jsxs)(l.A,{columnGap:"space.100",justifyContent:"end",children:[(0,p.jsx)(a.A,{ref:h,appearance:"default",onClick:()=>{g(!1),e.onNo?.()},children:"No"}),(0,p.jsx)(a.A,{ref:f,appearance:"danger",onClick:()=>{g(!1),e.onYes?.()},children:"Yes"})]})]}),trigger:r=>"function"==typeof s?s({triggerProps:r,isOpen:m,setIsOpen:g}):(0,p.jsx)(n.A,{...r,icon:t,label:"Delete",isDisabled:e.isDisabled,isLoading:e.isLoading,onClick:t=>{e.stopPropagation&&t.stopPropagation(),g((e=>!e))}})})}},62494:(e,t,s)=>{s.d(t,{V:()=>c});var r=s(15490),a=s(53857),n=s(88764),i=s(58124),o=s(74848);const c=()=>{const e=(0,i.QN)((e=>e.settings.workingDaysPerWeek)),t=(0,i.QN)((e=>e.settings.workingHoursPerDay));return(0,o.jsxs)(r.A,{xcss:(0,a.S7)({marginBottom:"space.100"}),children:[(0,o.jsx)(n.A,{children:"Use the format: 2w 3d 4h 5m"}),(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"w"})," = weeks"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"d"})," = days"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"h"})," = hours"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"m"})," = minutes"]})]}),(0,o.jsxs)(n.A,{size:"small",color:"color.text.accent.gray",children:["📅 Workweek: ",e," days, 🕒 ",t," hours per day."]})]})}},24681:(e,t,s)=>{s.d(t,{M:()=>r});const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=Math.floor((e??0)/60),r=Math.floor(s/60);return`${String(r).padStart(2,"0")}:${String(s%60).padStart(2,"0")}${t?"h":""}`}}}]);